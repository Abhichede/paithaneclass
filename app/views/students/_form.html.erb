<div class="mdl-grid">
<%= link_to "<i class='material-icons'>keyboard_arrow_left</i> Back".html_safe,
            {controller: 'students', action: 'index', standard: params[:standard],
             section: params[:section] }, class: 'mdl-button mdl-js-button mdl-button--raised mdl-button--accent' %>
</div>
<div class="mdl-card demo-card-square mdl-shadow--2dp through mdl-shadow--16dp" id="student_form_card">
  <div class="mdl-card__title mdl-card--expand">
    <div class="mdl-card__title-text">
      <%= @student.id.nil? ? 'New Student' : 'Edit Student' %>
    </div>
  </div>
  <%= form_for(student) do |f| %>
      <% if student.errors.any? %>
          <div id="error_explanation">
            <h2><%= pluralize(student.errors.count, "error") %> prohibited this student from being saved:</h2>

            <ul>
              <% student.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
              <% end %>
            </ul>
          </div>
      <% end %>
      <div class="mdl-grid">
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell--6-col">

        </div>
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell--6-col">
          <%= image_tag 'user.png', :width => 150, :height => 150, class: 'img-circle', id: 'uploading_img' %>
          <%= f.file_field :profile_photo, class: 'mdl-textfield__input', style: 'visibility:hidden;', id: 'profile_photo' %>
          <%= f.label :profile_photo, class: 'mdl-button mdl-js-button mdl-button--raised mdl-button--accent', for: 'profile_photo' %>
        </div>
        <div class="mdl-layout-spacer"></div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">person</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :first_name, class: 'mdl-textfield__input', required: true %>
            <%= f.label :name, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">work</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :father_occupation, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :father_occupation, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">face</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :mother_name, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :mother_name, class: 'mdl-textfield__label' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">home</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :address, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :address, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">phone</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :mobile_no, class: 'mdl-textfield__input',
                             pattern: '^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$', required: true  %>
            <%= f.label :father_mobile_no, class: 'mdl-textfield__label' %>
            <span class="mdl-textfield__error">Enter valid mobile</span>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">contact_phone</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :alternate_mobile, class: 'mdl-textfield__input',
                             pattern: '^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$'  %>
            <%= f.label :alternate_mobile, class: 'mdl-textfield__label' %>
            <span class="mdl-textfield__error">Enter valid mobile</span>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">perm_contact_calendar</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="student_date_of_birth_div">
            <%= f.text_field :date_of_birth, id: 'student_date_of_birth',
                             class: 'mdl-textfield__input', required: true  %>
            <%= f.label :date_of_birth, class: 'mdl-textfield__label' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">school</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :college_name, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :college_name, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <%
        avl_classes  = ['Class']
        @fee_structure.each do |fee_structure|
          if !avl_classes.include?(fee_structure.student_class)
            avl_classes.push(fee_structure.student_class)
          end
        end
      %>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">class</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.select(:student_class, options_for_select(avl_classes, :disabled => 'Class',
                                                            :selected=> @student.student_class),
                         {}, class: 'mdl-textfield__input', id: 'student_class')  %>
            <%= f.label :student_class, class: 'mdl-textfield__label', for: 'student_class' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">turned_in</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <%
            avl_sections  = ['Section']
            @fee_structure.each do |fee_structure|
              if !avl_sections.include?(fee_structure.section)
                avl_sections.push(fee_structure.section)
              end
            end
          %>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.select(:division,
                         options_for_select(avl_sections, :disabled => 'Section', :selected=> @student.division),
                         {}, class: 'mdl-textfield__input', id: 'student_Section')  %>
            <%= f.label 'Section', class: 'mdl-textfield__label', for: 'student_Section' %>
          </div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">date_range</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="admission_date_div">
            <%= f.text_field :admission_date, id: 'admission_date',
                             class: 'mdl-textfield__input'  %>
            <%= f.label :admission_date, class: 'mdl-textfield__label' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">attach_money</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="allocated_fee_div">
            <%= f.text_field :allocated_fee, class: 'mdl-textfield__input',
                             pattern: '[0-9]+(\.[0-9][0-9]?)?',
                             id: 'allocated_fee', readonly: true, required: true %>
            <%= f.label :allocated_fee, class: 'mdl-textfield__label' %>
            <span class="mdl-textfield__error">Only decimal numbers with precision of 2 are allowed</span>
            <span class="hidden mdl-color-text--red" id="fee_not_allocated-error">Fee is not allocated for these class/section</span>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">format_list_numbered</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :no_of_installments, id: 'installment_no',
                             class: 'mdl-textfield__input' %>
            <%= f.label :no_of_installments, class: 'mdl-textfield__label' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">card_giftcard</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="allocated_fee_div">
            <%= f.text_field :discount, class: 'mdl-textfield__input',
                             pattern: '[0-9]+(\.[0-9][0-9]?)?',
                             id: 'discount' %>
            <%= f.label :discount, class: 'mdl-textfield__label', for: 'discount' %>
            <span class="mdl-textfield__error">Only decimal numbers with precision of 2 are allowed</span>
          </div>
        </div>
      </div>

      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">event</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.select(:academic_year_id, options_for_select( AcademicYear.all.map {|year| [year.year, year.id]}, :include_blank => 'year',
                                                                :disabled => 'year', :selected=> @student.academic_year_id),
                         {}, class: 'mdl-textfield__input', id: 'academic_year') %>
            <%= f.label :academic_year_id, class: 'mdl-textfield__label' %>
          </div>
        </div>
      </div>

      <div class="mdl-card__actions mdl-card--border">
        <div class="mdl-grid">
          <div class="mdl-layout-spacer"></div>
          <input type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" value="Submit" />
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
  <% end %>
</div>


<script type="text/javascript">
  $(function () {

    $('select#student_class').on('click', function () {
        get_allocated_fee();
    });
    $('select#student_Section').on('click', function () {
        get_allocated_fee();
    });

    var get_allocated_fee = function () {
        var s_class = $('select#student_class').val();
        var s_section = $('select#student_Section').val();

        console.log('clicked event');

        $.ajax({
            url: '<%= get_allocated_fee_url %>',
            data: 's_class='+ s_class +'&s_section='+ s_section,
            type: 'GET'
        });
    };

    $("input#profile_photo").on('change', function () {
        readURL(this);
    });

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#uploading_img').attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }
  });
</script>
