<div class="mdl-grid">
<%= link_to "<i class='material-icons'>keyboard_arrow_left</i> Back".html_safe,
            {controller: 'students', action: 'index', fee_id: params[:fee_id] }, class: 'mdl-button mdl-js-button mdl-button--raised mdl-button--accent' %>
</div>
<div class="mdl-card demo-card-square mdl-shadow--2dp through mdl-shadow--16dp" id="student_form_card">
  <div class="mdl-card__title mdl-card--expand">
    <div class="mdl-card__title-text">
      <%= @student.id.nil? ? 'New Student' : 'Edit Student' %>
    </div>
  </div>
  <%= form_for(student) do |f| %>
      <% if student.errors.any? %>
          <div id="error_explanation">
            <h2><%= pluralize(student.errors.count, "error") %> prohibited this student from being saved:</h2>

            <ul>
              <% student.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
              <% end %>
            </ul>
          </div>
      <% end %>
      <div class="mdl-grid">
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell--6-col">

        </div>
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell--6-col">
          <%= image_tag @student.profile_photo.blank? ? 'user.png' : @student.profile_photo, :width => 150, :height => 150, class: 'img-circle', id: 'uploading_img' %>
          <%= f.file_field :profile_photo, class: 'mdl-textfield__input', style: 'visibility:hidden;', id: 'profile_photo' %>
          <%= f.label :profile_photo, class: 'mdl-button mdl-js-button mdl-button--raised mdl-button--accent', for: 'profile_photo' %>
        </div>
        <div class="mdl-layout-spacer"></div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">person</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :first_name, class: 'mdl-textfield__input', required: true %>
            <%= f.label :name, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">work</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :father_occupation, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :father_occupation, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">face</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :mother_name, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :mother_name, class: 'mdl-textfield__label' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">home</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :address, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :address, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">phone</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :mobile_no, class: 'mdl-textfield__input',
                             pattern: '^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$', required: true  %>
            <%= f.label :father_mobile_no, class: 'mdl-textfield__label' %>
            <span class="mdl-textfield__error">Enter valid mobile</span>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">contact_phone</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :alternate_mobile, class: 'mdl-textfield__input',
                             pattern: '^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$'  %>
            <%= f.label :alternate_mobile, class: 'mdl-textfield__label' %>
            <span class="mdl-textfield__error">Enter valid mobile</span>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">perm_contact_calendar</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="student_date_of_birth_div">
            <%= f.text_field :date_of_birth, id: 'student_date_of_birth',
                             class: 'mdl-textfield__input', required: true  %>
            <%= f.label :date_of_birth, class: 'mdl-textfield__label' %>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">school</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.text_field :college_name, class: 'mdl-textfield__input', required: true  %>
            <%= f.label :college_name, class: 'mdl-textfield__label' %>
          </div>
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>

      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">class</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="multiselect ">
            <div class="selectBox mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <select class="mdl-textfield__input">
                <option>Select Course/Batch</option>
              </select>
              <div class="overSelect"></div>
            </div>
            <div id="checkboxes">
              <%= collection_check_boxes(:student, :fee_structure_ids, FeeStructure.all, :id, :structure) do |b| %>
                  <%= b.label(:"data-value" => b.value) { b.check_box + b.text } %>
              <% end %>
            </div>
          </div>
        </div>

        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">event</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.select(:academic_year_id, options_for_select( AcademicYear.all.map {|year| [year.year, year.id]}, :include_blank => 'year',
                                                                :disabled => 'year', :selected=> @student.academic_year_id),
                         {}, class: 'mdl-textfield__input', id: 'academic_year') %>
            <%= f.label :academic_year_id, class: 'mdl-textfield__label' %>
          </div>
        </div>
      </div>
      <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--1-col">
          <i class="material-icons prefix indigo-text mdl-textfield__label__icon">date_range</i>
        </div>
        <div class="mdl-cell mdl-cell--5-col">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="admission_date_div">
            <%= f.text_field :admission_date, id: 'admission_date',
                             class: 'mdl-textfield__input'  %>
            <%= f.label :admission_date, class: 'mdl-textfield__label' %>
          </div>
        </div>
      </div>

      <div class="mdl-card__actions mdl-card--border">
        <div class="mdl-grid">
          <div class="mdl-layout-spacer"></div>
          <input type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" value="Submit" />
          <div class="mdl-layout-spacer"></div>
        </div>
      </div>
  <% end %>
</div>


<script type="text/javascript">
  $(function () {
    $('select#student_class').on('click', function () {
        get_allocated_fee();
    });
    $('select#fee_structure_ids').on('change', function () {
        get_allocated_fee();
    });

    $(".selectBox").on('click', function () {
       showCheckboxes();
    });

    var get_allocated_fee = function () {
        var s_class = $('select#fee_structure_ids').val();

        console.log('clicked event');

        $.ajax({
            url: '<%= get_allocated_fee_url %>',
            data: 's_class='+ s_class,
            type: 'GET'
        });
    };

    $("input#profile_photo").on('change', function () {
        readURL(this);
    });

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#uploading_img').attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

      var expanded = false;

      function showCheckboxes() {
          var checkboxes = document.getElementById("checkboxes");
          if (!expanded) {
              checkboxes.style.display = "block";
              expanded = true;
          } else {
              checkboxes.style.display = "none";
              expanded = false;
          }
      }
  });
</script>
